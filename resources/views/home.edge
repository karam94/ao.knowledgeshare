@layout('layouts.app')

@section('content')

  <section class="section">
    <div class="container">
      <h1 class="subtitle is-3">ü§ì Latest {{ (category.name) ? category.name : '' }} {{ (message) ? message : '' }} Posts</h1>
      @if(category)
      <div class="column is-full" style="height: 65px;">
        <form action="{{ route('subscribe') }}" method="post" enctype="multipart/form-data" style="display:inline;">
          {{ csrfField() }}

          <input type="hidden" name="category_id" value="{{ category.id }}">
          <button class="button {{ userIsSubscribed ? 'is-danger' : 'is-success' }}" style="float:right;" type="submit">
            @if(userIsSubscribed)
              <span class="icon">
                <i class="fas fa-user-plus"></i>
              </span>
              <span>Unsubscribe</span>
            @else
              <span class="icon">
                <i class="fas fa-user-plus"></i>
              </span>
              <span>Subscribe</span>
            @endif
          </button>
        </form>
      </div>
      @endif

      @include('partials._notification')

      <div class="columns is-multiline">
        @each(post in posts.data)
          <div class="column is-one-quarter">
            <div class="card" style="height: 100%;">
              
                <div class="card-image">
                  <figure class="image is-4by3">
                      <a href="{{ route('details', { id: post.id }) }}">
                        <img src="{{ assetsUrl(post.image) }}" alt="Post image">
                      </a>
                  </figure>
                </div>

                <div class="card-content">
                    <div class="media">
                      <div class="media-content">
                        <h3 class="title is-5">                    
                          <a href="{{ route('details', { id: post.id }) }}">
                            üì∞ &nbsp; {{ post.title }}
                          </a>
                        </h3>

                        <p class="subtitle is-6">
                          shared by {{ post.poster.username }}
                          <br/>
                        </p>
                      </div>
                    </div>
                
                    <div class="content">
                      {{ post.description.length > 40 ? post.description.substring(0, 40) + '...' : post.description }}
                      <hr/>
                      <div class="columns">
                        <div class="column">
                          <a href="{{ route('posts', { category_id: post.category_id }) }}">
                              <span class="tag">
                                {{ post.category.name }}
                              </span>
                          </a>
                        </div>

                        <div class="column" style="text-align:right;">
                            <i class="far fa-heart"></i> {{ post.likes.length }} &nbsp;
                            <i class="far fa-comment"></i> {{ post.comments.length }}
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
          </div>
        @else
          <p>No posts to display.</p>
        @endeach
      </div>

      @if(posts.data.length)
      <hr>
      @!component('components.pagination', pagination = posts)
      @endif

      <br/><br/>

      <a name="latestQuestions"></a>
      <h1 class="subtitle is-3">ü§î Latest {{ (category.name) ? category.name : '' }}{{ (message) ? message : '' }} Questions</h2>
      <div class="columns is-multiline">
          @each(question in questions.data)
            <div class="column is-full">
              <div class="card">
                <a name="question{{question.id}}">
                <header class="card-header">
                  <h3 class="title is-5 card-header-title">
                    <a href="{{ route('questionDetails', { id: question.id }) }}">
                      ‚ùì &nbsp; {{ question.title }}
                    </a>
                  </h3>
                  <span style="padding: 0.75em">
                    asked by {{ question.poster.username }}
                  </span>
                </header>
                <div class="card-content">
                  <div class="content">
                    {{ question.description.length > 250 ? question.description.substring(0, 250) + '...' : question.description }}
                    <hr>
                    <a href="{{ route('posts', { category_id: question.category.id }) }}">
                      <span class="tag">
                        {{ question.category.name }}
                      </span>
                    </a>                  
                    <span style="float:right;">
                      Created at {{ question.created_at }}
                    </span>
                  </div>
                </div>
                
                <footer class="card-footer">
                  <form action="{{ route('question/upvote', { id: question.id }) }}" method="post" enctype="multipart/form-data" class="card-footer-item card-footer-item-upvote" onclick="this.submit();"
                  style="cursor:pointer; {{ question.upvotes.length > 0 ? 'background-color: #73a920' : 'background-color: white' }}">
                    {{ csrfField() }}

                    <input type="hidden" name="question_id" value="{{ question.id }}">

                    <a href="#" onclick="this.parentNode.submit(); return false;"
                    style="{{ question.upvotes.length > 0 ? 'color: white' : '' }}">
                      <i class="fas fa-caret-up"></i>
                    </a>
                  </form>

                  <span class="card-footer-item">
                    {{ question.score }}  {{ question.score == 1 || question.score == -1 ? 'Vote' : 'Votes' }}
                  </span>

                  <span class="card-footer-item">
                    {{ question.answers.length }} {{ question.answers.length == 1 ? 'Answer' : 'Answers' }}
                  </span>

                  <form action="{{ route('question/downvote', { id: question.id }) }}" method="post" enctype="multipart/form-data" class="card-footer-item card-footer-item-downvote" onclick="this.submit();"
                  style="cursor:pointer; {{ question.downvotes.length > 0 ? 'background-color: #ff3860' : 'background-color: white' }}">
                    {{ csrfField() }}
        
                    <input type="hidden" name="question_id" value="{{ question.id }}">

                    <a href="#" onclick="this.parentNode.submit(); return false;"
                    style="{{ question.downvotes.length > 0 ? 'color: white' : '' }}">
                      <i class="fas fa-caret-down"></i>
                    </a>
                  </form>
                </footer>
              </div>
            </div>
          @else
            <p>There are no unanswered questions at the moment!</p>
          @endeach
        </div>

        @if(questions.data.length)
        <hr>
        @!component('components.pagination', pagination = questions)
        @endif
    </div>
  </section>
@endsection